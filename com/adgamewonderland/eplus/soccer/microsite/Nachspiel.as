/* Nachspiel** Generated from ArgoUML Model ** ActionScript 2 generator module provided by www.codealloy.com */ /*klasse:			Nachspielautor: 			gerd jungbluth, adgame-wonderlandemail:			gerd.jungbluth@adgame-wonderland.dekunde:			epluserstellung: 		20.05.2004zuletzt bearbeitet:	07.06.2004durch			gjstatus:			in bearbeitung*/import com.adgamewonderland.agw.XMLConnector;import com.adgamewonderland.eplus.soccer.microsite.*;class com.adgamewonderland.eplus.soccer.microsite.Nachspiel extends Box {	// Attributes		private var myXMLConnector:XMLConnector;		private var myCities:Array, myCount:Number, myOffset:Number, myCity:Number, myImageinfos:Array;		private var myCityurl:String, myImgurl:String;		private var headline_txt:TextField;		private var forward_mc:MovieClip, backward_mc:MovieClip, dropdown_mc:MovieClip, gallery_mc:MovieClip, scrollbar_mc:MovieClip, img_mc:MovieClip, debug_mc:MovieClip;		// Operations		public  function Nachspiel()	{		// klassenname		myClassName = "Nachspiel";		// registrieren		Playground.registerBox(this);		// xml connector		myXMLConnector = new XMLConnector(this, "");		// infos ueber staedte		myCities = [];		// url des scripts, das die staedteinfos liefert		myCityurl = "http://194.245.72.226/nachspiel/xml_xchange.jsp"; // xml/eplussoccer_nachspiel_images_server.xml		// anzahl der bilder, die je seite angezeigt werden soll		myCount = 20;		// nummer des aktuell ersten bildes		myOffset = 0;		// infos ueber zu ladende bilder		myImageinfos = [];		// url der zu ladenden bilder		myImgurl = "http://194.245.72.226/nachspiel/upload/";				// buttons initialisieren		initButtons();		// infos ueber staedte laden		loadCities();	}		// buttons initialisieren	public function initButtons():Void	{		// array mit buttons		myButtons = [forward_mc, backward_mc];		// callback beim druecken von "weiter"		forward_mc.onRelease = function () {			this._parent.swapPage(1);		}		// callback beim druecken von "zurueck"		backward_mc.onRelease = function () {			this._parent.swapPage(-1);		}		// aktivieren		active = true;		// sichtbarkeit updaten		updateButtons();	}		// buttons updaten (sichtbar / unsichtbar)	public function updateButtons():Void	{		// button nach links ein- / ausblenden		backward_mc._visible = (myOffset > myCount);		// button nach rechts ein- / ausblenden		forward_mc._visible = (myOffset < myCities[myCity].images - myCount);	}		// infos ueber staedte laden	public function loadCities():Void	{		// url		myXMLConnector.setUrl("xml/eplussoccer_nachspiel_cities_server.xml");		// laden		myXMLConnector.loadXML("onCitiesLoaded");	}		// callback nach laden der infos ueber staedte	public function onCitiesLoaded(xmlobj:XML ):Void	{		// infos ueber stadte		var cities:Array = xmlobj.firstChild.childNodes;		// items fuer dropdown		var items:Array = [];		// werte fuer dropdown		var values:Array = [];		// schleife ueber alle staedte		for (var i in cities) {			// in object umformen			var city:Object = myXMLConnector.parseXMLNode(cities[i]);			// in array schreiben			myCities[Number(city["id"])] = city;			// item fuer dropdown			items.push(city["name"]);			// wert fuer dropdown			values.push(city["id"]);		}		// dropdown initialisieren		dropdown_mc.initDropdown("WÄHLEN SIE EINE STADT", items, values, "selectCity", -20);	}		// callback beim waehlen einer stadt	public function selectCity(id:Number ):Void	{		// nummer der stadt merken		myCity = id;		// info ueber gewaehlte stadt		var info:Object = myCities[id];		// breite		headline_txt.autoSize = "left";		headline_txt.html = true;		headline_txt.multiline = true;		// name anzeigen		headline_txt.htmlText = "Vorhang auf für die E-Plus Reserve aus " + info["name"] + "<BR>Vor dem Spiel gab's von Rudi noch letzte Instruktionen...";		// offset auf 1		myOffset = 1;		// sichtbarkeit updaten		updateButtons();		// galerie loeschen		removeGallery();		// bilderliste anfordern		loadImageinfos(myCity);	}		// infos ueber bilder aus einer stadt laden	public function loadImageinfos(cityid:Number ):Void	{		// xml head		var xmlobj:XML = myXMLConnector.getXMLHead("eplussoccer", {obj : "nachspiel"});		// node bauen		var node:XMLNode = myXMLConnector.getXMLNode("city", {id : cityid, offset : myOffset, count : myCount});		// einhaengen		xmlobj.firstChild.appendChild(node);		// url		myXMLConnector.setUrl(myCityurl);		// senden und laden		myXMLConnector.sendXML(xmlobj, "onImageinfosLoaded");	}	// callback nach laden der infos ueber bilder aus einer stadt 	public function onImageinfosLoaded(xmlobj:XML ):Void	{		// infos ueber zu ladende bilder		myImageinfos = [];		// infos ueber bilder		var imageinfos:Array = xmlobj.firstChild.firstChild.childNodes;		// schleife ueber alle bilder		for (var i in imageinfos) {			// in object umformen			var info:Object = myXMLConnector.parseXMLNode(imageinfos[i]);			// in array schreiben			myImageinfos.push(info);		}		// reihenfolge richten		myImageinfos.reverse();		// bildergalerie anzeigen		showGallery();	}		// bildergalerie anzeigen	public function showGallery():Void	{		// schleife ueber alle aktuellen infos		for (var i in myImageinfos) {			// info ueber aktuelles bild			var info:Object = myImageinfos[i];			// movieclip, das das bild darstellt			var mc:MovieClip = gallery_mc["img" + (Number(i) + 1) + "_mc"];			// id speichern			mc.id = i;			// name			mc.name_txt.text = info["name"];			// breite			mc.name_txt.autoSize = "left";			// loader text			mc.loader_txt.autoSize = "center";			if (info["small"]) mc.loader_txt.text ="Bild wird geladen";			// loader			mc.onEnterFrame = function () {				// laden verfolgen				if (this.pic_mc.getBytesTotal() > 4 && this.pic_mc.getBytesLoaded() == this.pic_mc.getBytesTotal()) {					// loader fertig					delete(this.onEnterFrame);					// loader text					mc.loader_txt.text ="";					// button, um grosses bild anzusehen					this.onRelease = function () {						this._parent._parent.showImage(this.id);					}				}			}			// neues movieclip, in das das jpeg geladen wird			mc.createEmptyMovieClip("pic_mc", 1);			// positionieren			mc.pic_mc._x = mc.pic_mc._y = 5;			// jpeg laden			mc.pic_mc.loadMovie(myImgurl + info["small"]);		}	}		// bildergalerie loeschen	public function removeGallery():Void	{		// scrollbar nach oben		scrollbar_mc.setThumbPosition(0);		// galerie nach oben		scrollbar_mc.setTargetPosition(0);		// schleife ueber alle aktuellen infos		for (var i in myImageinfos) {			// movieclip, das das bild darstellt			var mc:MovieClip = gallery_mc["img" + (Number(i) + 1) + "_mc"];			// button loeschen			delete (mc.onRelease);			// name			mc.name_txt.text = "";			// loader text			mc.loader_txt.text ="";			// movieclip, in das das jpeg geladen wird, loeschen			mc.pic_mc.removeMovieClip();		}	}		// einzelnes bild in gross anzeigen	public function showImage(id:Number )	{		// info ueber aktuelles bild		var info:Object = myImageinfos[id];		// movieclip, das das bild darstellt		var mc:MovieClip = img_mc.createEmptyMovieClip("pic_mc", 1);		// positionieren		mc._x = 273;		mc._y = 253;		// loader text		img_mc.loader_txt.autoSize = "center";		img_mc.loader_txt.text ="Bild wird geladen";		// loader		img_mc.onEnterFrame = function () {			// laden verfolgen			if (this.pic_mc.getBytesTotal() > 4 && this.pic_mc.getBytesLoaded() == this.pic_mc.getBytesTotal()) {				// loader fertig				delete(this.onEnterFrame);				// loader text				this.loader_txt.text ="";			}		}		// jpeg laden		mc.loadMovie(myImgurl + info["large"]);		// sichtbar machen		img_mc._visible = true;	}		// zwischen seiten navigieren	public function swapPage(dir:Number ):Void	{		// offset zaehlen		myOffset += dir * myCount;		// sichtbarkeit navigation updaten		updateButtons();		// galerie loeschen		removeGallery();		// bilderliste anfordern		loadImageinfos(myCity);	}} /* end class Nachspiel */